# Tomcat Runtime Asset

## Introduction
The `tomcat-runtime` asset provides a zip archive containing
- original Tomcat files
- tribefire extensions such as the `dev-loader`, `tomcat-juli.jar` replacement (with custom logging extensions)
- templates which are evaluated during Tomcat setup, e.g. `catalina.sh.vm`.

Jinnis uses this archive when performing a local Tomcat setup (i.e. `setup-local-tomcat-platform`).

## Building
The archive is created as part of the artifact build process, so from pure building perspective there is nothing special to know.

## Runtime Asset Creation
What happens during the build process is that the original Tomcat files (stored in folder `runtime-original/`) and the tribefire extensions & modifications (see folder `runtime-modifications/`) are merged into a single folder from which the archive is created.

Some files from `runtime-modifications` extend the original runtime, e.g. adding Braintribe's `dev-loader`. Others replace original files, e.g. a `tomcat-juli.jar` replacement with custom logging extension.
The folders `runtime-modifications/custom/` and `runtime-modifications/custom-auto-maintained/` both have a `_projection` folder which contains templates which are also included in the `tomcat-runtime` asset. These templates are evaluated by Jinni as part of a Tomcat setup. The respective original files are removed from `tomcat-runtime` archive.
For example, `catalina.sh` is created during Jinni setup based on template `catalina.sh.vm`. Hence, the template `catalina.sh.vm` is included in the archive, the original `catalina.sh` isn't.

## Folder Structure Info

- `runtime-original/`: extracted files from Tomcat archive (`apache-tomcat-[version]-windows-x64.zip`) without any modifications except that the following folders were removed:
	- `runtime-original/host/logs/`
	- `runtime-original/host/temp/`
	- `runtime-original/host/webapps/docs/`
	- `runtime-original/host/webapps/examples/`
	- `runtime-original/host/webapps/ROOT/`
- `runtime-modifications/`: custom files which are needed in order to create a new `tomcat-runtime` asset
	- `runtime-modifications/custom/`: custom files which have to be maintained/updated manually
	- `runtime-modifications/custom-auto-maintained/`: custom files which are auto-generated by the `update.sh` script and thus must not be modified manually (see below)

## Updating

- `update.sh`: the update script used to (to some extent) automate `tomcat-runtime` asset updates. It is run periodically by the respective update pipeline.


There is an update script (`update.sh`) which semi-automates `tomcat-runtime` asset updates. That means it helps updating the files in `runtime-original/` and `runtime-modifications/custom/`.
The update script is used by a pipeline which periodically checks, if new versions of Tomcat or our extensions are available.

### !!ATTENTION!!
The files in `runtime-modifications/custom-auto-maintained/` are updated automatically by the update script. Never modify them manually!

If you want respective files to be changed, either adjust the `update.sh` script or ask for help on `#pd-cxz-rat`.
